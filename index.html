<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Seletiva FTMSP 2025 - Lady, S√™nior e Veteranos</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f5f5f5;
      color: #333;
      margin: 0;
      padding: 0;
    }

    header {
      background-color: #a80000;
      color: white;
      text-align: center;
      padding: 1rem;
    }

    header img {
      height: 80px;
      margin-bottom: 10px;
    }

    main {
      max-width: 850px;
      margin: 20px auto;
      background-color: white;
      border-radius: 10px;
      padding: 25px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    select, button {
      padding: 10px;
      font-size: 1rem;
      margin: 5px 0;
    }

    select {
      width: 100%;
      border-radius: 5px;
      border: 1px solid #ccc;
    }

    .athlete {
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #ddd;
      padding: 10px 0;
    }

    .btn {
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin-left: 5px;
      padding: 8px 12px;
      transition: 0.2s;
    }

    .btn-green {
      background-color: #2e8b57;
    }

    .btn-green:hover {
      background-color: #1f6a3f;
    }

    .btn-red {
      background-color: #a80000;
    }

    .btn-red:hover {
      background-color: #7a0000;
    }

    .confirmation {
      margin-top: 20px;
      text-align: center;
      font-weight: bold;
      padding: 12px;
      border-radius: 6px;
      display: none;
      animation: fadeOut 1s ease 3s forwards;
    }

    .confirmation.show {
      display: block;
    }

    .confirmation.success {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    footer {
      text-align: center;
      font-size: 0.9rem;
      margin-top: 20px;
      color: #777;
    }

    @keyframes fadeOut {
      to { opacity: 0; visibility: hidden; }
    }

    /* üîπ Estilos do modal */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.6);
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 10px;
      width: 90%;
      max-width: 400px;
      text-align: center;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
    }

    .modal-content h3 {
      margin-top: 0;
      color: #a80000;
    }

    .modal-content input {
      width: 90%;
      padding: 10px;
      margin-top: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 1rem;
    }

    .modal-buttons {
      margin-top: 15px;
      display: flex;
      justify-content: space-around;
    }
  </style>
</head>
<body>
  <header>
    <img src="logo.png" alt="Logo Federa√ß√£o de T√™nis de Mesa de S√£o Paulo">
    <h1>Seletiva FTMSP 2025 - Lady, S√™nior e Veteranos</h1>
  </header>

  <main>
    <p>
      Caros dirigentes, confirme abaixo a participa√ß√£o de seu atleta na Seletiva FTMSP 2025.<br>
      Selecione o clube e responda referente ao(s) seu(s) atleta(s).<br><br>
      Caso o atleta tenha interesse em participar da seletiva, desde que esteja entre os 4 primeiros colocados, selecione a op√ß√£o <b>‚ÄúQUERO JOGAR A SELETIVA‚Äù</b>.<br>
      Caso o atleta n√£o queira, selecione a op√ß√£o <b>‚ÄúN√ÉO VOU JOGAR A SELETIVA‚Äù</b>.
    </p>

    <h3>Selecione o Clube:</h3>
    <select id="clubSelect">
      <option value="">-- Escolha um clube --</option>
    </select>

    <div id="athletesList"></div>

    <div class="confirmation" id="confirmationMsg"></div>
  </main>

  <footer>
    ¬© 2025 Federa√ß√£o de T√™nis de Mesa do Estado de S√£o Paulo
  </footer>

  <!-- üîπ Modal para confirma√ß√£o de e-mail -->
  <div id="emailModal" class="modal">
    <div class="modal-content">
      <h3>Confirma√ß√£o de resposta</h3>
      <p id="modalText"></p>
      <input type="email" id="emailInput" placeholder="Digite seu e-mail" required>
      <div class="modal-buttons">
        <button id="confirmBtn" class="btn btn-green">Confirmar</button>
        <button id="cancelBtn" class="btn btn-red">Cancelar</button>
      </div>
    </div>
  </div>

  <script>
    const formURL = "https://docs.google.com/forms/d/e/1FAIpQLSeTzU-AClRCSuW7sWT5t0wjnKMLzIEZVzvyYYil4TEl12k4Cg/formResponse";

    const ENTRY_ID_NOME = "entry.434251181";
    const ENTRY_ID_CLUBE = "entry.224125101";
    const ENTRY_ID_CATEGORIA = "entry.441182629";
    const ENTRY_ID_DECISAO = "entry.778892213";
    const ENTRY_ID_EMAIL = "entry.969707115"; // ‚úÖ Campo de e-mail

    let athletes = [];
    let pendingData = null;

    async function loadCSV() {
      const response = await fetch("seletivaftmsplista.csv");
      const data = await response.text();
      const delimiter = data.includes(";") ? ";" : ",";
      const rows = data.split("\n").slice(1);

      athletes = rows
        .map(row => row.trim())
        .filter(row => row.length > 0)
        .map(row => {
          const [Nome, Clube, Categoria] = row.split(delimiter);
          return { Nome: Nome?.trim(), Clube: Clube?.trim(), Categoria: Categoria?.trim() };
        })
        .filter(a => a.Nome && a.Clube && a.Categoria);

      populateClubs();
    }

    function populateClubs() {
      const clubSelect = document.getElementById("clubSelect");
      const clubs = [...new Set(athletes.map(a => a.Clube))].sort();
      clubs.forEach(club => {
        const option = document.createElement("option");
        option.value = club;
        option.textContent = club;
        clubSelect.appendChild(option);
      });
      clubSelect.addEventListener("change", () => showAthletes(clubSelect.value));
    }

    function showAthletes(club) {
      const listDiv = document.getElementById("athletesList");
      listDiv.innerHTML = "";
      const filtered = athletes.filter(a => a.Clube === club);

      if (filtered.length === 0) {
        listDiv.innerHTML = "<p>Nenhum atleta encontrado para este clube.</p>";
        return;
      }

      filtered.forEach(a => {
        const div = document.createElement("div");
        div.className = "athlete";
        div.innerHTML = `
          <div>
            <strong>${a.Nome}</strong><br>
            <small>${a.Categoria}</small>
          </div>
          <div>
            <button class="btn btn-green" onclick="openEmailModal('${a.Nome}', '${a.Clube}', '${a.Categoria}', 'Quero jogar a seletiva')">QUERO JOGAR</button>
            <button class="btn btn-red" onclick="openEmailModal('${a.Nome}', '${a.Clube}', '${a.Categoria}', 'N√£o vou jogar a seletiva')">N√ÉO VOU</button>
          </div>
        `;
        listDiv.appendChild(div);
      });
    }

    function openEmailModal(nome, clube, categoria, decisao) {
      pendingData = { nome, clube, categoria, decisao };
      document.getElementById("modalText").textContent =
        `Por favor, somente o dirigente, t√©cnico ou o pr√≥prio atleta pode responder. Confirme a resposta de ${nome}: "${decisao}".`;
      document.getElementById("emailInput").value = "";
      document.getElementById("emailModal").style.display = "flex";
    }

    async function confirmEmail() {
      const email = document.getElementById("emailInput").value.trim();
      if (!email) {
        alert("Por favor, insira seu e-mail.");
        return;
      }
      const emailValido = /^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(email);
      if (!emailValido) {
        alert("Digite um e-mail v√°lido.");
        return;
      }

      const { nome, clube, categoria, decisao } = pendingData;
      document.getElementById("emailModal").style.display = "none";

      const formData = new FormData();
      formData.append(ENTRY_ID_NOME, nome);
      formData.append(ENTRY_ID_CLUBE, clube);
      formData.append(ENTRY_ID_CATEGORIA, categoria);
      formData.append(ENTRY_ID_DECISAO, decisao);
      formData.append(ENTRY_ID_EMAIL, email);

      await fetch(formURL, { method: "POST", mode: "no-cors", body: formData });

      const msgDiv = document.getElementById("confirmationMsg");
      msgDiv.className = "confirmation success show";
      msgDiv.textContent = `‚úÖ Resposta registrada: ${nome} - ${decisao}. Enviado por: ${email}`;

      setTimeout(() => {
        msgDiv.className = "confirmation";
        msgDiv.textContent = "";
      }, 4000);
    }

    function closeModal() {
      document.getElementById("emailModal").style.display = "none";
    }

    document.getElementById("confirmBtn").addEventListener("click", confirmEmail);
    document.getElementById("cancelBtn").addEventListener("click", closeModal);

    loadCSV();
  </script>
</body>
</html>
